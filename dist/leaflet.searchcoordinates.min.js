/*! leaflet.searchcoordinates 22-08-2014 */
L.Control.SearchCoords=L.Control.extend({options:{position:"topleft"},initialize:function(a){L.Control.prototype.initialize.call(this,a),this._actionButtons={},this._actionsVisible=!1},onAdd:function(){var a,b,c,d,e=L.DomUtil.create("div",""),f=L.DomUtil.create("div","leaflet-bar",e),g=3,h=["lat","lon"],i=["Широта","Долгота"],j=280,k=L.DomUtil.create("div","leaflet-find-actions",e),l=L.DomUtil.create("form","form-inline",k);for(this._toolbarContainer=f,k.style.width=j+"px",d=L.DomUtil.create("a","glyphicon glyphicon-search",f),d.href="#",d.title="Find coordinates",L.DomEvent.on(d,"click",L.DomEvent.stopPropagation).on(d,"mousedown",L.DomEvent.stopPropagation).on(d,"dblclick",L.DomEvent.stopPropagation).on(d,"click",L.DomEvent.preventDefault).on(d,"click",this.onFind,this),a=0;g>a;a++)b=L.DomUtil.create("div","form-group",l),c=this._createInput(2==a?{type:"submit",container:b,callback:this.onActionClick,context:this}:{type:"text",name:h[a],text:i[a],container:b,context:this});return this._actionsContainer=k,e},_createButton:function(a){var b=L.DomUtil.create("a",a.className||"",a.container);return b.href="#",a.text&&(b.innerHTML=a.text),a.title&&(b.title=a.title),L.DomEvent.on(b,"click",L.DomEvent.stopPropagation).on(b,"mousedown",L.DomEvent.stopPropagation).on(b,"dblclick",L.DomEvent.stopPropagation).on(b,"click",L.DomEvent.preventDefault).on(b,"click",a.callback,a.context),b},_createInput:function(a){if("text"==a.type){var b=L.DomUtil.create("label","sr-only",a.container);b.setAttribute("for","input_"+a.name),b.innerHTML=a.text;var c=L.DomUtil.create("input","form-control input-sm",a.container);c.setAttribute("id","input_"+a.name),c.setAttribute("placeholder",a.text)}else if("submit"==a.type){var d=L.DomUtil.create("div","btn btn-default btn-leaflet",a.container);d.setAttribute("id","search"),d.innerHTML="Искать",L.DomEvent.on(d,"click",L.DomEvent.stopPropagation).on(d,"mousedown",L.DomEvent.stopPropagation).on(d,"dblclick",L.DomEvent.stopPropagation).on(d,"click",L.DomEvent.preventDefault).on(d,"click",a.callback,a.context)}},_showActionsToolbar:function(){L.DomUtil.addClass(this._toolbarContainer,"leaflet-find-actions-visible"),this._actionsContainer.style.display="block",this._actionsVisible=!0},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-find-actions-visible"),this._actionsVisible=!1},coordValid:function(a,b){return"#input_lat"==a.selector&&b>90?(a.attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Широта не может быть больше 90 градусов"),a.tooltip("show"),0):"#input_lon"==a.selector&&b>180?(a.attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Долгота не может быть больше 180 градусов"),a.tooltip("show"),0):b},coordFormat:function(a){var b=a.val();if(""===b)return a.attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Обязательно для ввода"),a.tooltip("show"),!1;if(a.tooltip("destroy"),/[a-z]|[а-я]/.test(b))return a.attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Неправильный формат"),a.tooltip("show"),!1;if(/\d{1,3}\s\d{1,2}\s\d+/.test(b)){var c=b.split(/\s/),d=parseInt(c[0]),e=parseInt(c[1])/60,f=parseInt(c[2])/3600;return this.coordValid(a,d+e+f)}return/\d{2,3}[\b]|\d{2,3}./.test(b)?this.coordValid(a,b):(a.attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Неправильный формат"),a.tooltip("show"),!1)},onActionClick:function(){var a=$("#input_lat"),b=$("#input_lon"),c=this.coordFormat(a),d=this.coordFormat(b);if(c&&d){var e=L.marker([c,d]).addTo(map),f=L.DomUtil.create("div",""),g=L.DomUtil.create("div","",f);g.innerHTML="N "+c+"<br>E "+d;var h=L.DomUtil.create("a","",f);h.innerHTML="Удалить маркер",h.href="#";var i=L.DomEvent.stopPropagation;L.DomEvent.on(h,"click",i).on(h,"mousedown",i).on(h,"dblclick",i).on(h,"click",L.DomEvent.preventDefault).on(h,"click",function(){this._map.removeLayer(e)},this),e.bindPopup(f),map.setView(e.getLatLng(),map.getZoom())}},onFind:function(){this._actionsVisible?this._hideActionsToolbar():this._showActionsToolbar()}}),L.control.searchcoords=function(a){return new L.Control.SearchCoords(a)};